
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sunpy.map.mapbase &#8212; SunPy v0.8.dev8694</title>
    
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.8.dev8694',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/version.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /><!-- Facebook OpenGraph -->
    <meta property="og:title" content="sunpy.map.mapbase | SunPy v0.8.dev8694" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="/_modules/sunpy/map/mapbase.html" />
    <meta property="og:image" content="/_static/img/sunpy_icon.svg" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="SunPy v0.8.dev8694" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  </head>
  <body role="document">


<div id="navbar" class="navbar navbar-default navbar-fixed-top">
  <div class="container">
	  <div class="navbar-header">
	    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
	      <span class="icon-bar"></span>
	      <span class="icon-bar"></span>
	      <span class="icon-bar"></span>
	    </button>
	    <a class="navbar-brand" href="http://sunpy.org">SunPy</a>
	    <span class="navbar-text navbar-version pull-left"><b></b></span>
	  </div>
	  <div class="collapse navbar-collapse nav-collapse">
	    <ul class="nav navbar-nav">
		    
		    <div class="collapse navbar-collapse nav-collapse">
			    <ul class="nav navbar-nav navbar-left">
			    	<li class="dropdown">
			    	 <a role="button" id="dLabelGlobalToc" data-toggle="dropdown" data-target="#" href="#">About<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li class="dropdown-submenu">
                  <a href="https://duygukeskek.github.io/sunpy-website/about.html">About</a>
                </li>
                <li class="dropdown-submenu">
                  <a href="https://duygukeskek.github.io/sunpy-website/about.html#acknowledging-sunpy">Acknowledge</a>
            		</li>
            		<li class="dropdown-submenu">
                  <a href="https://github.com/sunpy/sunpy/blob/master/CODE_OF_CONDUCT.md">Code of Conduct</a>
            		</li>
              </ul>              
			      </li>
			      <li><a href="https://duygukeskek.github.io/sunpy-website/blog.html">Blog</a></li>
			      <li class="dropdown">
			    	 <a role="button" id="dLabelGlobalToc" data-toggle="dropdown" data-target="#" href="#">Documentation<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li class="dropdown-submenu">
                  <a href="http://sunpy.org/sunpy-sphinx-theme/index.html">SunPy</a>
                </li>
                <li class="dropdown-submenu">
                  <a href="http://docs.sunpy.org/projects/irispy/en/latest/">IRISPy</a>
            		</li>
            		<li class="dropdown-submenu">
                  <a href="http://docs.sunpy.org/projects/solarbextrapolation/en/latest/">SolarBExtrapolation</a>
            		</li>
            		<li class="dropdown-submenu">
                  <a href="http://docs.sunpy.org/projects/sunkit-sst/en/latest/index.html">sunkit-sst</a>
            		</li>
              </ul>              
			      </li>
			      <li><a href="../../../index.html">Documentation</a></li>
       	        <div class="social-links">
        			<a href="https://twitter.com/share" class="twitter-share-button" data-via="sunpyproject">Tweet</a>
				    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        	        <iframe src="https://ghbtns.com/github-btn.html?user=sunpy&repo=sunpy&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
        	       </div>
	        	
	    	
	        </ul>
	    </div>	    
      </ul>
	  </div>
  </div>
</div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">

    <p class="doc-title">
        <a style="padding-left: 0" href="../../../index.html">SunPy 0.8.dev8694</a>
    </p>
    <form class="navbar-form navbar-right" action="../../../search.html" method="get">
        <div class="form-group">
            <input type="text" name="q" class="form-control" placeholder="Search" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/index.html">SunPy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_ref/index.html">Code Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../generated/gallery/index.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_guide/index.html">Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testingfeatures.html">Testing new features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bugs.html">Reporting Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ssw.html">SSWIDL/SunPy Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Full Changelog</a></li>
</ul>


        </div>
      </div>
    <div class="col-md-9 content">
      
  <h1>Source code for sunpy.map.mapbase</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Map is a generic Map class from which all other Map classes inherit from.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">sunpy.extern.six.moves</span> <span class="k">import</span> <span class="nb">range</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">namedtuple</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">patches</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">colors</span>

<span class="kn">import</span> <span class="nn">astropy.wcs</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.visualization.wcsaxes</span> <span class="k">import</span> <span class="n">WCSAxes</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="k">import</span> <span class="n">SkyCoord</span>

<span class="kn">import</span> <span class="nn">sunpy.io</span> <span class="k">as</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">sunpy.coordinates</span>
<span class="kn">from</span> <span class="nn">sunpy.util.decorators</span> <span class="k">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">sunpy</span> <span class="k">import</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">sunpy.extern</span> <span class="k">import</span> <span class="n">six</span>
<span class="kn">from</span> <span class="nn">sunpy.visualization</span> <span class="k">import</span> <span class="n">toggle_pylab</span><span class="p">,</span> <span class="n">wcsaxes_compat</span><span class="p">,</span> <span class="n">axis_labels_from_ctype</span>
<span class="kn">from</span> <span class="nn">sunpy.sun</span> <span class="k">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">sunpy.sun</span> <span class="k">import</span> <span class="n">sun</span>
<span class="kn">from</span> <span class="nn">sunpy.time</span> <span class="k">import</span> <span class="n">parse_time</span><span class="p">,</span> <span class="n">is_time</span>
<span class="kn">from</span> <span class="nn">sunpy.image.transform</span> <span class="k">import</span> <span class="n">affine_transform</span>
<span class="kn">from</span> <span class="nn">sunpy.image.rescale</span> <span class="k">import</span> <span class="n">reshape_image_to_4d_superpixel</span>
<span class="kn">from</span> <span class="nn">sunpy.image.rescale</span> <span class="k">import</span> <span class="n">resample</span> <span class="k">as</span> <span class="n">sunpy_image_resample</span>
<span class="kn">from</span> <span class="nn">sunpy.coordinates</span> <span class="k">import</span> <span class="n">get_sun_B0</span><span class="p">,</span> <span class="n">get_sun_L0</span><span class="p">,</span> <span class="n">get_sunearth_distance</span>

<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="k">import</span> <span class="n">NDData</span>

<span class="n">TIME_FORMAT</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="s2">&quot;time_format&quot;</span><span class="p">)</span>
<span class="n">PixelPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;PixelPair&#39;</span><span class="p">,</span> <span class="s1">&#39;x y&#39;</span><span class="p">)</span>
<span class="n">SpatialPair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SpatialPair&#39;</span><span class="p">,</span> <span class="s1">&#39;axis1 axis2&#39;</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GenericMap&#39;</span><span class="p">]</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Questions</span>
<span class="sd">---------</span>
<span class="sd">* Should we use Helioviewer or VSO&#39;s data model? (e.g. map.meas, map.wavelength</span>
<span class="sd">or something else?)</span>
<span class="sd">* Should &#39;center&#39; be renamed to &#39;offset&#39; and crpix1 &amp; 2 be used for &#39;center&#39;?</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># GenericMap subclass registry.</span>
<span class="n">MAP_CLASSES</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">GenericMapMetaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registration metaclass for `~sunpy.map.GenericMap`.</span>

<span class="sd">    This class checks for the existance of a method named ``is_datasource_for``</span>
<span class="sd">    when a subclass of `GenericMap` is defined. If it exists it will add that</span>
<span class="sd">    class to the registry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_registry</span> <span class="o">=</span> <span class="n">MAP_CLASSES</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">members</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">GenericMapMetaclass</span><span class="p">,</span> <span class="n">mcls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">members</span><span class="p">)</span>

        <span class="c1"># The registry contains the class as the key and the validation method</span>
        <span class="c1"># as the item.</span>
        <span class="k">if</span> <span class="s1">&#39;is_datasource_for&#39;</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="n">mcls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_datasource_for</span>

        <span class="k">return</span> <span class="bp">cls</span>


<span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">GenericMapMetaclass</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap">[docs]</a><span class="k">class</span> <span class="nc">GenericMap</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Generic spatially-aware 2D data array</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : `~numpy.ndarray`, list</span>
<span class="sd">        A 2d list or ndarray containing the map data</span>
<span class="sd">    meta : dict</span>
<span class="sd">        A dictionary of the original image header tags</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import sunpy.map</span>
<span class="sd">    &gt;&gt;&gt; import sunpy.data.sample</span>
<span class="sd">    &gt;&gt;&gt; aia = sunpy.map.Map(sunpy.data.sample.AIA_171_IMAGE)</span>
<span class="sd">    &gt;&gt;&gt; aia   # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">    SunPy AIAMap</span>
<span class="sd">    ---------</span>
<span class="sd">    Observatory:         SDO</span>
<span class="sd">    Instrument:  AIA 3</span>
<span class="sd">    Detector:    AIA</span>
<span class="sd">    Measurement:         171.0 Angstrom</span>
<span class="sd">    Wavelength:  171.0 Angstrom</span>
<span class="sd">    Obs Date:    2011-03-19 10:54:00</span>
<span class="sd">    dt:          1.999601 s</span>
<span class="sd">    Dimension:   [ 1024.  1024.] pix</span>
<span class="sd">    scale:               [ 2.4  2.4] arcsec / pix</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    array([[ 0.3125, -0.0625, -0.125 , ...,  0.625 , -0.625 ,  0.    ],</span>
<span class="sd">           [ 1.    ,  0.1875, -0.8125, ...,  0.625 , -0.625 ,  0.    ],</span>
<span class="sd">           [-1.1875,  0.375 , -0.5   , ..., -0.125 , -0.625 , -1.1875],</span>
<span class="sd">           ...,</span>
<span class="sd">           [-0.625 ,  0.0625, -0.3125, ...,  0.125 ,  0.125 ,  0.125 ],</span>
<span class="sd">           [ 0.5625,  0.0625,  0.5625, ..., -0.0625, -0.0625,  0.    ],</span>
<span class="sd">           [ 0.5   , -0.125 ,  0.4375, ...,  0.6875,  0.6875,  0.6875]])</span>


<span class="sd">    &gt;&gt;&gt; aia.spatial_units</span>
<span class="sd">    SpatialPair(axis1=Unit(&quot;arcsec&quot;), axis2=Unit(&quot;arcsec&quot;))</span>
<span class="sd">    &gt;&gt;&gt; aia.peek()   # doctest: +SKIP</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    A number of the properties of this class are returned as two-value named</span>
<span class="sd">    tuples that can either be indexed by position ([0] or [1]) or be accessed</span>
<span class="sd">    by the names (.x and .y) or (.axis1 and .axis2). Things that refer to pixel</span>
<span class="sd">    axes use the ``.x``, ``.y`` convention, where x and y refer to the FITS</span>
<span class="sd">    axes (x for columns y for rows). Spatial axes use ``.axis1`` and ``.axis2``</span>
<span class="sd">    which correspond to the first and second axes in the header. ``axis1``</span>
<span class="sd">    corresponds to the coordinate axis for ``x`` and ``axis2`` corresponds to</span>
<span class="sd">    ``y``.</span>

<span class="sd">    This class makes some assumptions about the WCS information contained in</span>
<span class="sd">    the meta data. The first and most extensive assumption is that it is</span>
<span class="sd">    FITS-like WCS information as defined in the FITS WCS papers.</span>

<span class="sd">    Within this scope it also makes some other assumptions.</span>

<span class="sd">    * In the case of APIS convention headers where the CROTAi/j arguments are</span>
<span class="sd">      provided it assumes that these can be converted to the standard PCi_j</span>
<span class="sd">      notation using equations 32 in Thompson (2006).</span>

<span class="sd">    * If a CDi_j matrix is provided it is assumed that it can be converted to a</span>
<span class="sd">      PCi_j matrix and CDELT keywords as described in</span>
<span class="sd">      `Greisen &amp; Calabretta (2002) &lt;http://dx.doi.org/10.1051/0004-6361:20021327&gt;`_</span>

<span class="sd">    * The &#39;standard&#39; FITS keywords that are used by this class are the PCi_j</span>
<span class="sd">      matrix and CDELT, along with the other keywords specified in the WCS</span>
<span class="sd">      papers. All subclasses of this class must convert their header</span>
<span class="sd">      information to this formalism. The CROTA to PCi_j conversion is done in</span>
<span class="sd">      this class.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This class currently assumes that a header with the CDi_j matrix</span>
<span class="sd">        information also includes the CDELT keywords, without these keywords</span>
<span class="sd">        this class will not process the WCS.</span>
<span class="sd">        Also the rotation_matrix does not work if the CDELT1 and CDELT2</span>
<span class="sd">        keywords are exactly equal.</span>
<span class="sd">        Also, if a file with more than two dimensions is feed into the class,</span>
<span class="sd">        only the first two dimensions (NAXIS1, NAXIS2) will be loaded and the</span>
<span class="sd">        rest will be discarded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">plot_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># If the data has more than two dimensions, the first dimensions</span>
        <span class="c1"># (NAXIS1, NAXIS2) are used and the rest are discarded.</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># We create a slice that removes all but the &#39;last&#39; two</span>
            <span class="c1"># dimensions. (Note dimensions in ndarray are in reverse order)</span>

            <span class="n">new_2d_slice</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ndim</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">new_2d_slice</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">new_2d_slice</span><span class="p">]</span>
            <span class="c1"># Warn the user that the data has been truncated</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span><span class="s2">&quot;This file contains more than 2 dimensions. &quot;</span>
                                   <span class="s2">&quot;Only the first two dimensions will be used.&quot;</span>
                                   <span class="s2">&quot; The truncated data will not be saved in a new file.&quot;</span><span class="p">,</span>
                                   <span class="ne">Warning</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">GenericMap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Correct possibly missing meta keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_naxis</span><span class="p">()</span>

        <span class="c1"># Setup some attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nickname</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Validate header</span>
        <span class="c1"># TODO: This should be a function of the header, not of the map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_meta</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shift</span> <span class="o">=</span> <span class="n">SpatialPair</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">()</span>

        <span class="c1"># Visualization attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                              <span class="s1">&#39;norm&#39;</span><span class="p">:</span> <span class="n">norm</span><span class="p">,</span>
                              <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span>
                              <span class="p">}</span>
        <span class="k">if</span> <span class="n">plot_settings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plot_settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This should allow indexing by physical coordinate &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The ability to index Map by physical&quot;</span>
            <span class="s2">&quot; coordinate is not yet implemented.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
<span class="sd">&quot;&quot;&quot;SunPy Map</span>
<span class="sd">---------</span>
<span class="sd">Observatory:\t\t {obs}</span>
<span class="sd">Instrument:\t\t {inst}</span>
<span class="sd">Detector:\t\t {det}</span>
<span class="sd">Measurement:\t\t {meas}</span>
<span class="sd">Wavelength:\t\t {wave}</span>
<span class="sd">Observation Date:\t {date:{tmf}}</span>
<span class="sd">Exposure Time:\t\t {dt:f}</span>
<span class="sd">Dimension:\t\t {dim}</span>
<span class="sd">Coordinate System:\t {coord.name}</span>
<span class="sd">Scale:\t\t\t {scale}</span>
<span class="sd">Reference Pixel:\t {refpix}</span>
<span class="sd">Reference Coord:\t {refcoord}</span>

<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observatory</span><span class="p">,</span> <span class="n">inst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument</span><span class="p">,</span> <span class="n">det</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="p">,</span>
           <span class="n">meas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
           <span class="n">dt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exposure_time</span><span class="p">,</span>
           <span class="n">dim</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">),</span>
           <span class="n">scale</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">),</span>
           <span class="n">coord</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">,</span>
           <span class="n">refpix</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_pixel</span><span class="p">),</span>
           <span class="n">refcoord</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_coordinate</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">reference_coordinate</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">)),</span>
           <span class="n">tmf</span><span class="o">=</span><span class="n">TIME_FORMAT</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_new_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">plot_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiate a new instance of this class using given data.</span>
<span class="sd">        This is a shortcut for ``type(self)(data, meta, plot_settings)``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">plot_settings</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_lon_lat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a coordinate frame, extract the lon and lat by casting to</span>
<span class="sd">        SphericalWrap180Representation first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">represent_as</span><span class="p">(</span><span class="n">sunpy</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">representation</span><span class="o">.</span><span class="n">SphericalWrap180Representation</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">r</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The `~astropy.wcs.WCS` property of the map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">WCS</span><span class="p">(</span><span class="n">naxis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">crpix</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_pixel</span><span class="p">)</span>
        <span class="c1"># Make these a quantity array to prevent the numpy setting element of</span>
        <span class="c1"># array with sequence error.</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cdelt</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">crval</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference_longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference_latitude</span><span class="p">])</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">ctype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_matrix</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">dateobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">heliographic_observer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observer_coordinate</span>
        <span class="n">w2</span><span class="o">.</span><span class="n">rsun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsun_meters</span>

        <span class="c1"># Astropy WCS does not understand the SOHO default of &quot;solar-x&quot; and</span>
        <span class="c1"># &quot;solar-y&quot; ctypes.  This overrides the default assignment and</span>
        <span class="c1"># changes it to a ctype that is understood.  See Thompson, 2006, A.&amp;A.,</span>
        <span class="c1"># 449, 791.</span>
        <span class="k">if</span> <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">ctype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;solar-x&quot;</span><span class="p">,</span> <span class="s2">&quot;solar_x&quot;</span><span class="p">):</span>
            <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">ctype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HPLN-TAN&#39;</span>

        <span class="k">if</span> <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">ctype</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;solar-y&quot;</span><span class="p">,</span> <span class="s2">&quot;solar_y&quot;</span><span class="p">):</span>
            <span class="n">w2</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">ctype</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HPLT-TAN&#39;</span>

        <span class="k">return</span> <span class="n">w2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coordinate_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An `astropy.coordinates.BaseFrame` instance created from the coordinate</span>
<span class="sd">        information for this Map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">astropy</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">wcs_to_celestial_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_as_mpl_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compatibility hook for Matplotlib and WCSAxes.</span>
<span class="sd">        This functionality requires the WCSAxes package to work. The reason</span>
<span class="sd">        we include this here is that it allows users to use WCSAxes without</span>
<span class="sd">        having to explicitly import WCSAxes</span>
<span class="sd">        With this method, one can do::</span>

<span class="sd">            import matplotlib.pyplot as plt</span>
<span class="sd">            import sunpy.map</span>
<span class="sd">            amap = sunpy.map.Map(&#39;filename.fits&#39;)</span>
<span class="sd">            fig = plt.figure()</span>
<span class="sd">            ax = plt.subplot(projection=amap)</span>
<span class="sd">            ...</span>

<span class="sd">        and this will generate a plot with the correct WCS coordinates on the</span>
<span class="sd">        axes. See http://wcsaxes.readthedocs.io for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This code is reused from Astropy</span>

        <span class="k">return</span> <span class="n">WCSAxes</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;wcs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">}</span>

    <span class="c1"># Some numpy extraction</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The dimensions of the array (x axis first, y axis second).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PixelPair</span><span class="p">(</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s1">&#39;pixel&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The `numpy.dtype` of the array of the map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number of pixels in the array of the map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;pixel&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The value of `numpy.ndarray.ndim` of the data array of the map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span>

<div class="viewcode-block" id="GenericMap.std"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.std">[docs]</a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the standard deviation of the data array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericMap.mean"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the mean of the data array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericMap.min"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the minimum value of the data array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericMap.max"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the maximum value of the data array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="c1"># #### Keyword attribute and other attribute definitions #### #</span>

    <span class="k">def</span> <span class="nf">_base_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract the shared bit between name and latex_name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{nickname}</span><span class="s2"> {{measurement}} {date:</span><span class="si">{tmf}</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nickname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nickname</span><span class="p">,</span>
                                                                <span class="n">date</span><span class="o">=</span><span class="n">parse_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">),</span>
                                                                <span class="n">tmf</span><span class="o">=</span><span class="n">TIME_FORMAT</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Human-readable description of the Map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">()</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measurement</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latex_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;LaTeX formatted description of the Map.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">()</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measurement</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="o">.</span><span class="n">_repr_latex_</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nickname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An abbreviated human-readable description of the map-type; part of</span>
<span class="sd">        the Helioviewer data model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nickname</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nickname</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span>

    <span class="nd">@nickname</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">nickname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nickname</span> <span class="o">=</span> <span class="n">n</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Image observation time&quot;&quot;&quot;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">parse_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date-obs&#39;</span><span class="p">,</span> <span class="s1">&#39;now&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span><span class="s2">&quot;Missing metadata for observation time.&quot;</span>
                                   <span class="s2">&quot; Using current time.&quot;</span><span class="p">,</span>
                                   <span class="ne">Warning</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">,</span>
                                   <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parse_time</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Detector name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;detector&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dsun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The observer distance from the Sun.&quot;&quot;&quot;</span>
        <span class="n">dsun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dsun_obs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dsun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span><span class="s2">&quot;Missing metadata for Sun-spacecraft&quot;</span>
                                   <span class="s2">&quot; separation: assuming Sun-Earth distance&quot;</span><span class="p">,</span>
                                   <span class="ne">Warning</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">,</span>
                                   <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
            <span class="n">dsun</span> <span class="o">=</span> <span class="n">get_sunearth_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">dsun</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exposure_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exposure time of the image in seconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exptime&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instrument</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instrument name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instrume&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Measurement name, defaults to the wavelength of image&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wavelnth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;waveunit&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wavelength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;wavelength of the observation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wavelnth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;waveunit&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observatory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Observatory or Telescope name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;obsrvtry&#39;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;telescop&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">processing_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the FITS processing level if present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lvl_num&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;0.8&quot;</span><span class="p">,</span> <span class="s2">&quot;This property is only valid for non-rotated WCS&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">xrange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the X range of the image from edge to edge.&quot;&quot;&quot;</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;0.8&quot;</span><span class="p">,</span> <span class="s2">&quot;This property is only valid for non-rotated WCS&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">yrange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Y range of the image from edge to edge.&quot;&quot;&quot;</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bottom_left_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The physical coordinate for the bottom left [0,0] pixel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">,</span> <span class="mi">0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">top_right_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The physical coordinate for the top left pixel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a coordinate object for the center pixel of the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="o">*</span><span class="n">center</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shifted_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The total shift applied to the reference coordinate by past applications of</span>
<span class="sd">        `~sunpy.map.GenericMap.shift`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shift</span>

    <span class="nd">@u</span><span class="o">.</span><span class="n">quantity_input</span><span class="p">(</span><span class="n">axis1</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">axis2</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.shift"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.shift">[docs]</a>    <span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a map shifted by a specified amount to, for example, correct</span>
<span class="sd">        for a bad map location. These values are applied directly to the</span>
<span class="sd">        `~sunpy.map.GenericMap.reference_coordinate`. To check how much shift</span>
<span class="sd">        has already been applied see `~sunpy.map.GenericMap.shifted_value`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        axis1 : `~astropy.units.Quantity`</span>
<span class="sd">            The shift to apply to the Longitude (solar-x) coordinate.</span>

<span class="sd">        axis2 : `~astropy.units.Quantity`</span>
<span class="sd">            The shift to apply to the Latitude (solar-y) coordinate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : `~sunpy.map.GenericMap` or subclass</span>
<span class="sd">            A new shifted Map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Update crvals</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crval1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;crval1&#39;</span><span class="p">]</span> <span class="o">*</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">value</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crval2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;crval2&#39;</span><span class="p">]</span> <span class="o">*</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Create new map with the modification</span>
        <span class="n">new_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_instance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">new_meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="p">)</span>

        <span class="n">new_map</span><span class="o">.</span><span class="n">_shift</span> <span class="o">=</span> <span class="n">SpatialPair</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shifted_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis1</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">shifted_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_map</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rsun_meters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Radius of the sun in meters&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rsun_ref&#39;</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">radius</span><span class="p">),</span> <span class="s1">&#39;meter&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rsun_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Radius of the Sun.&quot;&quot;&quot;</span>
        <span class="n">rsun_arcseconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rsun_obs&#39;</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;solar_r&#39;</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span>
                                                                    <span class="kc">None</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">rsun_arcseconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span><span class="s2">&quot;Missing metadata for solar radius:&quot;</span>
                                   <span class="s2">&quot; assuming photospheric limb as seen from Earth&quot;</span><span class="p">,</span>
                                   <span class="ne">Warning</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">,</span>
                                   <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
            <span class="n">rsun_arcseconds</span> <span class="o">=</span> <span class="n">sun</span><span class="o">.</span><span class="n">solar_semidiameter_angular_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;arcsec&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">rsun_arcseconds</span><span class="p">,</span> <span class="s1">&#39;arcsec&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coordinate_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Coordinate system used for x and y axes (ctype1/2)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SpatialPair</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ctype1&#39;</span><span class="p">,</span> <span class="s1">&#39;HPLN-   &#39;</span><span class="p">),</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ctype2&#39;</span><span class="p">,</span> <span class="s1">&#39;HPLT-   &#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">carrington_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Carrington longitude (crln_obs)&quot;&quot;&quot;</span>
        <span class="n">carrington_longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;crln_obs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">carrington_longitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span><span class="s2">&quot;Missing metadata for Carrington longitude:&quot;</span>
                                   <span class="s2">&quot; assuming Earth-based observer&quot;</span><span class="p">,</span>
                                   <span class="ne">Warning</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">,</span>
                                   <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
            <span class="n">carrington_longitude</span> <span class="o">=</span> <span class="n">get_sun_L0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">carrington_longitude</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">carrington_longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">carrington_longitude</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">carrington_longitude</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">heliographic_latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Heliographic latitude&quot;&quot;&quot;</span>
        <span class="n">heliographic_latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hglt_obs&#39;</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;crlt_obs&#39;</span><span class="p">,</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;solar_b0&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">heliographic_latitude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span><span class="s2">&quot;Missing metadata for heliographic latitude:&quot;</span>
                                   <span class="s2">&quot; assuming Earth-based observer&quot;</span><span class="p">,</span>
                                   <span class="ne">Warning</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">,</span>
                                   <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
            <span class="n">heliographic_latitude</span> <span class="o">=</span> <span class="n">get_sun_B0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heliographic_latitude</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">heliographic_latitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">heliographic_latitude</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">heliographic_latitude</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">heliographic_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Heliographic longitude&quot;&quot;&quot;</span>
        <span class="n">heliographic_longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hgln_obs&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heliographic_longitude</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">heliographic_longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">heliographic_longitude</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">heliographic_longitude</span><span class="p">,</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observer_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The Heliographic Stonyhurst Coordinate of the observer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heliographic_latitude</span><span class="p">,</span>
                        <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heliographic_longitude</span><span class="p">,</span>
                        <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dsun</span><span class="p">,</span>
                        <span class="n">obstime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;heliographic_stonyhurst&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_reference_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        FITS-WCS compatible longitude. Used in self.wcs and</span>
<span class="sd">        self.reference_coordinate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;crval1&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_reference_latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;crval2&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reference_coordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference point WCS axes in data units (i.e. crval1, crval2). This value</span>
<span class="sd">        includes a shift if one is set.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference_longitude</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reference_latitude</span><span class="p">,</span>
                        <span class="n">frame</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reference_pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference point axes in pixels (i.e. crpix1, crpix2)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PixelPair</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;crpix1&#39;</span><span class="p">,</span>
                                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;naxis1&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;crpix2&#39;</span><span class="p">,</span>
                                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;naxis2&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Image scale along the x and y axes in units/pixel (i.e. cdelt1, cdelt2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Fix this if only CDi_j matrix is provided</span>
        <span class="k">return</span> <span class="n">SpatialPair</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cdelt1&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cdelt2&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spatial_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Image coordinate units along the x and y axes (i.e. cunit1, cunit2).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SpatialPair</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cunit1&#39;</span><span class="p">,</span> <span class="s1">&#39;arcsec&#39;</span><span class="p">)),</span>
                           <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cunit2&#39;</span><span class="p">,</span> <span class="s1">&#39;arcsec&#39;</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matrix describing the rotation required to align solar North with</span>
<span class="sd">        the top of the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;PC1_1&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;PC1_1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;PC1_2&#39;</span><span class="p">]],</span>
                              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;PC2_1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;PC2_2&#39;</span><span class="p">]]])</span>

        <span class="k">elif</span> <span class="s1">&#39;CD1_1&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CD1_1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CD1_2&#39;</span><span class="p">]],</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CD2_1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CD2_2&#39;</span><span class="p">]]])</span>

            <span class="n">cdelt</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

            <span class="k">return</span> <span class="n">cd</span> <span class="o">/</span> <span class="n">cdelt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotation_matrix_from_crota</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rotation_matrix_from_crota</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method converts the deprecated CROTA FITS kwargs to the new</span>
<span class="sd">        PC rotation matrix.</span>

<span class="sd">        This method can be overriden if an instruments header does not use this</span>
<span class="sd">        conversion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CROTA2&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">)],</span>
                          <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">lam</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">)]])</span>

<span class="c1"># #### Miscellaneous #### #</span>

    <span class="k">def</span> <span class="nf">_fix_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Check commonly used but non-standard FITS keyword for observation</span>
        <span class="c1"># time and correct the keyword if we can. Keep updating old one for</span>
        <span class="c1"># backwards compatibility.</span>
        <span class="k">if</span> <span class="n">is_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_obs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;date-obs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;date_obs&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fix_naxis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># If naxis is not specified, get it from the array shape</span>
        <span class="k">if</span> <span class="s1">&#39;naxis1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;naxis1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;naxis2&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;naxis2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;naxis&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;naxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>

    <span class="k">def</span> <span class="nf">_fix_bitpix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Bit-depth</span>
        <span class="c1">#</span>
        <span class="c1">#   8    Character or unsigned binary integer</span>
        <span class="c1">#  16    16-bit twos-complement binary integer</span>
        <span class="c1">#  32    32-bit twos-complement binary integer</span>
        <span class="c1"># -32    IEEE single precision floating point</span>
        <span class="c1"># -64    IEEE double precision floating point</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="s1">&#39;bitpix&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">float_fac</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;f&quot;</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;bitpix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">float_fac</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>

    <span class="k">def</span> <span class="nf">_get_cmap_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the default color map name.&quot;&quot;&quot;</span>
        <span class="n">cmap_string</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observatory</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;detector&#39;</span><span class="p">]</span> <span class="o">+</span>
                       <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">cmap_string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_validate_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the meta-information associated with a Map.</span>

<span class="sd">        This method includes very basic validation checks which apply to</span>
<span class="sd">        all of the kinds of files that SunPy can read. Datasource-specific</span>
<span class="sd">        validation should be handled in the relevant file in the</span>
<span class="sd">        sunpy.map.sources package.</span>

<span class="sd">        Allows for default unit assignment for:</span>
<span class="sd">            CUNIT1, CUNIT2, WAVEUNIT</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">meta_property</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cunit1&#39;</span><span class="p">,</span> <span class="s1">&#39;cunit2&#39;</span><span class="p">,</span> <span class="s1">&#39;waveunit&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">meta_property</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">meta_property</span><span class="p">),</span>
                       <span class="n">parse_strict</span><span class="o">=</span><span class="s1">&#39;silent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">physical_type</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">):</span>

                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unknown value for &quot;</span> <span class="o">+</span> <span class="n">meta_property</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                              <span class="ne">Warning</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;SOLX&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLY&#39;</span><span class="p">))</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;SOLX&#39;</span><span class="p">,</span> <span class="s1">&#39;SOLY&#39;</span><span class="p">))):</span>

            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;SunPy Map currently does not support three dimensional data,&quot;</span>
                          <span class="s2">&quot; and therefore can not represent heliocentric coordinates. &quot;</span>
                          <span class="s2">&quot;Creating a map in this frame will almost certainly result in errors.&quot;</span><span class="p">)</span>


<span class="c1"># #### Data conversion routines #### #</span>
<div class="viewcode-block" id="GenericMap.world_to_pixel"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.world_to_pixel">[docs]</a>    <span class="k">def</span> <span class="nf">world_to_pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a world (data) coordinate to a pixel coordinate by using</span>
<span class="sd">        `~astropy.wcs.WCS.wcs_world2pix`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinate : `~astropy.coordinates.SkyCoord` or `~astropy.coordinates.BaseFrame`</span>
<span class="sd">            The coordinate object to convert to pixel coordinates.</span>

<span class="sd">        origin : int</span>
<span class="sd">            Origin of the top-left corner. i.e. count from 0 or 1.</span>
<span class="sd">            Normally, origin should be 0 when passing numpy indices, or 1 if</span>
<span class="sd">            passing values from FITS header or map attributes.</span>
<span class="sd">            See `~astropy.wcs.WCS.wcs_world2pix` for more information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x : `~astropy.units.Quantity`</span>
<span class="sd">            Pixel coordinate on the CTYPE1 axis.</span>

<span class="sd">        y : `~astropy.units.Quantity`</span>
<span class="sd">            Pixel coordinate on the CTYPE2 axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinate</span><span class="p">,</span> <span class="p">(</span><span class="n">SkyCoord</span><span class="p">,</span>
                                       <span class="n">astropy</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">BaseCoordinateFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;world_to_pixel takes a Astropy coordinate frame or SkyCoord instance.&quot;</span><span class="p">)</span>

        <span class="n">native_frame</span> <span class="o">=</span> <span class="n">coordinate</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="n">native_frame</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">wcs_world2pix</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PixelPair</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">)</span></div>

    <span class="c1"># Thought it would be easier to create a copy this way.</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;0.8.0&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;sunpy.map.GenericMap.world_to_pixel&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.data_to_pixel"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.data_to_pixel">[docs]</a>    <span class="k">def</span> <span class="nf">data_to_pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See `~sunpy.map.mapbase.GenericMap.world_to_pixel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">coordinate</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span></div>

    <span class="nd">@u</span><span class="o">.</span><span class="n">quantity_input</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.pixel_to_world"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.pixel_to_world">[docs]</a>    <span class="k">def</span> <span class="nf">pixel_to_world</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a pixel coordinate to a data (world) coordinate by using</span>
<span class="sd">        `~astropy.wcs.WCS.wcs_pix2world`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        x : `~astropy.units.Quantity`</span>
<span class="sd">            Pixel coordinate of the CTYPE1 axis. (Normally solar-x).</span>

<span class="sd">        y : `~astropy.units.Quantity`</span>
<span class="sd">            Pixel coordinate of the CTYPE2 axis. (Normally solar-y).</span>

<span class="sd">        origin : int</span>
<span class="sd">            Origin of the top-left corner. i.e. count from 0 or 1.</span>
<span class="sd">            Normally, origin should be 0 when passing numpy indices, or 1 if</span>
<span class="sd">            passing values from FITS header or map attributes.</span>
<span class="sd">            See `~astropy.wcs.WCS.wcs_pix2world` for more information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        coord : `astropy.coordinates.SkyCoord`</span>
<span class="sd">            A coordinate object representing the output coordinate.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">wcs_pix2world</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>

        <span class="c1"># If the wcs is celestial it is output in degress</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">is_celestial</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span></div>

    <span class="c1"># Thought it would be easier to create a copy this way.</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;0.8.0&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;sunpy.map.GenericMap.pixel_to_world&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.pixel_to_data"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.pixel_to_data">[docs]</a>    <span class="k">def</span> <span class="nf">pixel_to_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See `~sunpy.map.mapbase.GenericMap.pixel_to_world`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span></div>

<span class="c1"># #### I/O routines #### #</span>

<div class="viewcode-block" id="GenericMap.save"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves the SunPy Map object to a file.</span>

<span class="sd">        Currently SunPy can only save files in the FITS format. In the future</span>
<span class="sd">        support will be added for saving to other formats.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            Location to save file to.</span>

<span class="sd">        filetype : str</span>
<span class="sd">            &#39;auto&#39; or any supported file extension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">io</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="n">filetype</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="c1"># #### Image processing routines #### #</span>

    <span class="nd">@u</span><span class="o">.</span><span class="n">quantity_input</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.resample"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.resample">[docs]</a>    <span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a new Map that has been resampled up or down</span>

<span class="sd">        Arbitrary resampling of the Map to new dimension sizes.</span>

<span class="sd">        Uses the same parameters and creates the same co-ordinate lookup points</span>
<span class="sd">        as IDL&#39;&#39;s congrid routine, which apparently originally came from a</span>
<span class="sd">        VAX/VMS routine of the same name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dimensions : `~astropy.units.Quantity`</span>
<span class="sd">            Pixel dimensions that new Map should have.</span>
<span class="sd">            Note: the first argument corresponds to the &#39;x&#39; axis and the second</span>
<span class="sd">            argument corresponds to the &#39;y&#39; axis.</span>
<span class="sd">        method : {&#39;neighbor&#39; | &#39;nearest&#39; | &#39;linear&#39; | &#39;spline&#39;}</span>
<span class="sd">            Method to use for resampling interpolation.</span>
<span class="sd">                * neighbor - Closest value from original data</span>
<span class="sd">                * nearest and linear - Uses n x 1-D interpolations using</span>
<span class="sd">                  scipy.interpolate.interp1d</span>
<span class="sd">                * spline - Uses ndimage.map_coordinates</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : `~sunpy.map.GenericMap` or subclass</span>
<span class="sd">            A new Map which has been resampled to the desired dimensions.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        * `Rebinning &lt;http://www.scipy.org/Cookbook/Rebinning&gt;`_ (Original</span>
<span class="sd">          source, 2011/11/19)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Note: because the underlying ndarray is transposed in sense when</span>
        <span class="c1">#   compared to the Map, the ndarray is transposed, resampled, then</span>
        <span class="c1">#   transposed back</span>
        <span class="c1"># Note: &quot;center&quot; defaults to True in this function because data</span>
        <span class="c1">#   coordinates in a Map are at pixel centers</span>

        <span class="c1"># Make a copy of the original data and perform resample</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">sunpy_image_resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span>
                                        <span class="n">method</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">T</span>

        <span class="n">scale_factor_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">scale_factor_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Update image scale and number of pixels</span>
        <span class="n">new_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Update metadata</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;cdelt1&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_factor_x</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;cdelt2&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_factor_y</span>
        <span class="k">if</span> <span class="s1">&#39;CD1_1&#39;</span> <span class="ow">in</span> <span class="n">new_meta</span><span class="p">:</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;CD1_1&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_factor_x</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;CD2_1&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_factor_x</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;CD1_2&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_factor_y</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;CD2_2&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_factor_y</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crval1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">value</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crval2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Create new map instance</span>
        <span class="n">new_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_instance</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_map</span></div>

<div class="viewcode-block" id="GenericMap.rotate"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rmatrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
               <span class="n">recenter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">use_scipy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new rotated and rescaled map.</span>

<span class="sd">        Specify either a rotation angle or a rotation matrix, but not both. If</span>
<span class="sd">        neither an angle or a rotation matrix are specified, the map will be</span>
<span class="sd">        rotated by the rotation angle in the metadata.</span>

<span class="sd">        The map will be rotated around the reference coordinate defined in the</span>
<span class="sd">        meta data.</span>

<span class="sd">        This method also updates the ``rotation_matrix`` attribute and any</span>
<span class="sd">        appropriate header data so that they correctly describe the new map.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        angle : `~astropy.units.Quantity`</span>
<span class="sd">            The angle (degrees) to rotate counterclockwise.</span>
<span class="sd">        rmatrix : 2x2</span>
<span class="sd">            Linear transformation rotation matrix.</span>
<span class="sd">        order : int 0-5</span>
<span class="sd">            Interpolation order to be used. When using scikit-image this</span>
<span class="sd">            parameter is passed into :func:`skimage.transform.warp` (e.g., 4</span>
<span class="sd">            corresponds to bi-quartic interpolation).</span>
<span class="sd">            When using scipy it is passed into</span>
<span class="sd">            :func:`scipy.ndimage.interpolation.affine_transform` where it</span>
<span class="sd">            controls the order of the spline. Faster performance may be</span>
<span class="sd">            obtained at the cost of accuracy by using lower values.</span>
<span class="sd">            Default: 4</span>
<span class="sd">        scale : float</span>
<span class="sd">            A scale factor for the image, default is no scaling</span>
<span class="sd">        recenter : bool</span>
<span class="sd">            If True, position the axis of rotation at the center of the new map</span>
<span class="sd">            Default: False</span>
<span class="sd">        missing : float</span>
<span class="sd">            The numerical value to fill any missing points after rotation.</span>
<span class="sd">            Default: 0.0</span>
<span class="sd">        use_scipy : bool</span>
<span class="sd">            If True, forces the rotation to use</span>
<span class="sd">            :func:`scipy.ndimage.interpolation.affine_transform`, otherwise it</span>
<span class="sd">            uses the :func:`skimage.transform.warp`.</span>
<span class="sd">            Default: False, unless scikit-image can&#39;t be imported</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : `~sunpy.map.GenericMap` or subclass</span>
<span class="sd">            A new Map instance containing the rotated and rescaled data of the</span>
<span class="sd">            original map.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        sunpy.image.transform.affine_transform : The routine this method calls</span>
<span class="sd">        for the rotation.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function will remove old CROTA keywords from the header.</span>
<span class="sd">        This function will also convert a CDi_j matrix to a PCi_j matrix.</span>

<span class="sd">        See :func:`sunpy.image.transform.affine_transform` for details on the</span>
<span class="sd">        transformations, situations when the underlying data is modified prior</span>
<span class="sd">        to rotation, and differences from IDL&#39;s rot().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rmatrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot specify both an angle and a matrix&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">angle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rmatrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rmatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_matrix</span>

        <span class="c1"># This is out of the quantity_input decorator. To allow the angle=None</span>
        <span class="c1"># case. See https://github.com/astropy/astropy/issues/3734</span>
        <span class="k">if</span> <span class="n">angle</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">equivalent</span> <span class="o">=</span> <span class="n">angle</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">equivalent</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">u</span><span class="o">.</span><span class="n">UnitsError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;</span><span class="si">{0}</span><span class="s2">&#39; to function &#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span>
                                       <span class="s2">&quot; must be in units convertable to&quot;</span>
                                       <span class="s2">&quot; &#39;</span><span class="si">{2}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;angle&#39;</span><span class="p">,</span> <span class="s1">&#39;rotate&#39;</span><span class="p">,</span>
                                                        <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="o">.</span><span class="n">to_string</span><span class="p">()))</span>

            <span class="c1"># Either there is no .unit or no .is_equivalent</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">):</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;a &#39;unit&#39; attribute without an &#39;is_equivalent&#39; method&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;no &#39;unit&#39; attribute&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;</span><span class="si">{0}</span><span class="s2">&#39; to function &#39;</span><span class="si">{1}</span><span class="s2">&#39; has </span><span class="si">{2}</span><span class="s2">. &quot;</span>
                                <span class="s2">&quot;You may want to pass in an astropy Quantity instead.&quot;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;angle&#39;</span><span class="p">,</span> <span class="s1">&#39;rotate&#39;</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">))</span>

        <span class="c1"># Interpolation parameter sanity</span>
        <span class="k">if</span> <span class="n">order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Order must be between 0 and 5&quot;</span><span class="p">)</span>

        <span class="c1"># The FITS-WCS transform is by definition defined around the</span>
        <span class="c1"># reference coordinate in the header.</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_coordinate</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">rotation_center</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">])</span>

        <span class="c1"># Copy meta data</span>
        <span class="n">new_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Calculate the parameters for the affine_transform</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
            <span class="n">rmatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">],</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">]])</span>

        <span class="c1"># Calculate the shape in pixels to contain all of the image data</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">*</span> <span class="n">rmatrix</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">*</span> <span class="n">rmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Calculate the needed padding or unpadding</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">extent</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="c1"># Pad the image array</span>
        <span class="n">pad_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">diff</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)))</span>
        <span class="n">pad_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)))</span>

        <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                          <span class="p">((</span><span class="n">pad_y</span><span class="p">,</span> <span class="n">pad_y</span><span class="p">),</span> <span class="p">(</span><span class="n">pad_x</span><span class="p">,</span> <span class="n">pad_x</span><span class="p">)),</span>
                          <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span>
                          <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="n">missing</span><span class="p">,</span> <span class="n">missing</span><span class="p">))</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix1&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pad_x</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix2&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pad_y</span>

        <span class="c1"># All of the following pixel calculations use a pixel origin of 0</span>

        <span class="n">pixel_array_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">new_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="c1"># Create a temporary map so we can use it for the data to pixel calculation.</span>
        <span class="n">temp_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_instance</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="p">)</span>

        <span class="c1"># Convert the axis of rotation from data coordinates to pixel coordinates</span>
        <span class="n">pixel_rotation_center</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">temp_map</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_coordinate</span><span class="p">,</span>
                                                                  <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
        <span class="k">del</span> <span class="n">temp_map</span>

        <span class="k">if</span> <span class="n">recenter</span><span class="p">:</span>
            <span class="n">pixel_center</span> <span class="o">=</span> <span class="n">pixel_rotation_center</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pixel_center</span> <span class="o">=</span> <span class="n">pixel_array_center</span>

        <span class="c1"># Apply the rotation to the image data</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">affine_transform</span><span class="p">(</span><span class="n">new_data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rmatrix</span><span class="p">),</span>
                                    <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                                    <span class="n">image_center</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">pixel_center</span><span class="p">),</span>
                                    <span class="n">recenter</span><span class="o">=</span><span class="n">recenter</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                                    <span class="n">use_scipy</span><span class="o">=</span><span class="n">use_scipy</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="n">recenter</span><span class="p">:</span>
            <span class="n">new_reference_pixel</span> <span class="o">=</span> <span class="n">pixel_array_center</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate new pixel coordinates for the rotation center</span>
            <span class="n">new_reference_pixel</span> <span class="o">=</span> <span class="n">pixel_center</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rmatrix</span><span class="p">,</span>
                                                        <span class="n">pixel_rotation_center</span> <span class="o">-</span> <span class="n">pixel_center</span><span class="p">)</span>
            <span class="n">new_reference_pixel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_reference_pixel</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># Define the new reference_pixel</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crval1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crval2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_reference_pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># FITS pixel origin is 1</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_reference_pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># FITS pixel origin is 1</span>

        <span class="c1"># Unpad the array if necessary</span>
        <span class="n">unpad_x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">diff</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">unpad_x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[:,</span> <span class="n">unpad_x</span><span class="p">:</span><span class="o">-</span><span class="n">unpad_x</span><span class="p">]</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix1&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">unpad_x</span>
        <span class="n">unpad_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">diff</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">unpad_y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="n">unpad_y</span><span class="p">:</span><span class="o">-</span><span class="n">unpad_y</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix2&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">unpad_y</span>

        <span class="c1"># Calculate the new rotation matrix to store in the header by</span>
        <span class="c1"># &quot;subtracting&quot; the rotation matrix used in the rotate from the old one</span>
        <span class="c1"># That being calculate the dot product of the old header data with the</span>
        <span class="c1"># inverse of the rotation matrix.</span>
        <span class="n">pc_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">rmatrix</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;PC1_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pc_C</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;PC1_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pc_C</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;PC2_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pc_C</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;PC2_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pc_C</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Update pixel size if image has been scaled.</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;cdelt1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;cdelt2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Remove old CROTA kwargs because we have saved a new PCi_j matrix.</span>
        <span class="n">new_meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;CROTA1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">new_meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;CROTA2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Remove CDi_j header</span>
        <span class="n">new_meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;CD1_1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">new_meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;CD1_2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">new_meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;CD2_1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">new_meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;CD2_2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Create new map with the modification</span>
        <span class="n">new_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_instance</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_map</span></div>

<div class="viewcode-block" id="GenericMap.submap"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.submap">[docs]</a>    <span class="k">def</span> <span class="nf">submap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bottom_left</span><span class="p">,</span> <span class="n">top_right</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a submap of the map defined by the rectangle given by the</span>
<span class="sd">        ``[bottom_left, top_right]`` coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bottom_left : `astropy.units.Quantity` or `~astropy.coordinates.SkyCoord`</span>
<span class="sd">            The bottom_left coordinate of the rectangle. If a `SkyCoord` it can</span>
<span class="sd">            have shape ``(2,)`` and also define ``top_right``. If specifying</span>
<span class="sd">            pixel coordinates it must be given as an `~astropy.units.Quantity`</span>
<span class="sd">            object with units of `~astropy.units.pixel`.</span>
<span class="sd">        top_right : `astropy.units.Quantity` or `~astropy.coordinates.SkyCoord`</span>
<span class="sd">            The top_right coordinate of the rectangle. Can only be omitted if</span>
<span class="sd">            ``bottom_left`` has shape ``(2,)``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : `~sunpy.map.GenericMap` or subclass</span>
<span class="sd">            A new map instance is returned representing to specified sub-region</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import astropy.units as u</span>
<span class="sd">        &gt;&gt;&gt; import sunpy.map</span>
<span class="sd">        &gt;&gt;&gt; import sunpy.data.sample</span>
<span class="sd">        &gt;&gt;&gt; aia = sunpy.map.Map(sunpy.data.sample.AIA_171_IMAGE)</span>
<span class="sd">        &gt;&gt;&gt; bl = SkyCoord(-300*u.arcsec, -300*u.arcsec, frame=aia.coordinate_frame)</span>
<span class="sd">        &gt;&gt;&gt; tr = SkyCoord(500*u.arcsec, 500*u.arcsec, frame=aia.coordinate_frame</span>
<span class="sd">        &gt;&gt;&gt; aia.submap(bl, tr)   # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">        SunPy Map</span>
<span class="sd">        ---------</span>
<span class="sd">        Observatory:		 SDO</span>
<span class="sd">        Instrument:		 AIA 3</span>
<span class="sd">        Detector:		 AIA</span>
<span class="sd">        Measurement:		 171.0 Angstrom</span>
<span class="sd">        Wavelength:		 171.0 Angstrom</span>
<span class="sd">        Observation Date:	 2011-03-19 10:54:00</span>
<span class="sd">        Exposure Time:		 1.999601 s</span>
<span class="sd">        Dimension:		 [ 333.  333.] pix</span>
<span class="sd">        Coordinate System:	 helioprojective</span>
<span class="sd">        Scale:			 [ 2.4  2.4] arcsec / pix</span>
<span class="sd">        Reference Pixel:	 [ 125.5  125.5] pix</span>
<span class="sd">        Reference Coord:	 [ 0.  0.] arcsec</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        array([[ 365.625 ,  438.1875,  395.1875, ...,  201.375 ,  204.4375,  216.    ],</span>
<span class="sd">            [ 386.125 ,  389.5   ,  370.3125, ...,  207.3125,  202.1875,  196.75  ],</span>
<span class="sd">            [ 380.75  ,  342.875 ,  320.875 , ...,  187.5   ,  196.9375,</span>
<span class="sd">                178.875 ],</span>
<span class="sd">            ...,</span>
<span class="sd">            [ 225.3125,  219.1875,  211.1875, ...,  359.8125,  324.5625,</span>
<span class="sd">                305.375 ],</span>
<span class="sd">            [ 228.625 ,  228.8125,  225.8125, ...,  358.5   ,  318.    ,</span>
<span class="sd">                297.1875],</span>
<span class="sd">            [ 220.6875,  221.125 ,  209.625 , ...,  390.4375,  329.375 ,</span>
<span class="sd">                302.3125]])</span>

<span class="sd">        &gt;&gt;&gt; aia.submap([0,0]*u.pixel, [5,5]*u.pixel)   # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">        SunPy Map</span>
<span class="sd">        ---------</span>
<span class="sd">        Observatory:		 SDO</span>
<span class="sd">        Instrument:		 AIA 3</span>
<span class="sd">        Detector:		 AIA</span>
<span class="sd">        Measurement:		 171.0 Angstrom</span>
<span class="sd">        Wavelength:		 171.0 Angstrom</span>
<span class="sd">        Observation Date:	 2011-03-19 10:54:00</span>
<span class="sd">        Exposure Time:		 1.999601 s</span>
<span class="sd">        Dimension:		 [ 5.  5.] pix</span>
<span class="sd">        Coordinate System:	 helioprojective</span>
<span class="sd">        Scale:			 [ 2.4  2.4] arcsec / pix</span>
<span class="sd">        Reference Pixel:	 [ 512.5  512.5] pix</span>
<span class="sd">        Reference Coord:	 [ 0.  0.] arcsec</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        array([[ 0.3125, -0.0625, -0.125 ,  0.    , -0.375 ],</span>
<span class="sd">            [ 1.    ,  0.1875, -0.8125,  0.125 ,  0.3125],</span>
<span class="sd">            [-1.1875,  0.375 , -0.5   ,  0.25  , -0.4375],</span>
<span class="sd">            [-0.6875, -0.3125,  0.8125,  0.0625,  0.1875],</span>
<span class="sd">            [-0.875 ,  0.25  ,  0.1875,  0.    , -0.6875]])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bottom_left</span><span class="p">,</span> <span class="p">(</span><span class="n">astropy</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">,</span>
                                    <span class="n">astropy</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">BaseCoordinateFrame</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">top_right</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bottom_left</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If top_right is not specified bottom_left must have length two.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="n">bottom_left</span><span class="p">)</span>
                    <span class="n">top_right</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">lon</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lat</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                    <span class="n">bottom_left</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bottom_left</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="n">bottom_left</span><span class="p">))</span>
                <span class="n">top_right</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="n">top_right</span><span class="p">))</span>

            <span class="n">top_left</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">bottom_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">bottom_right</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">top_right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bottom_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

            <span class="n">corners</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">bottom_left</span><span class="p">,</span> <span class="n">bottom_right</span><span class="p">,</span> <span class="n">top_left</span><span class="p">,</span> <span class="n">top_right</span><span class="p">])</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
            <span class="n">pixel_corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

            <span class="c1"># Round the pixel values, we use floor+1 so that we always have at</span>
            <span class="c1"># least one pixel width of data.</span>
            <span class="n">x_pixels</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pixel_corners</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pixel_corners</span><span class="o">.</span><span class="n">x</span><span class="p">)])</span><span class="o">.</span><span class="n">value</span>
            <span class="n">x_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">x_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">y_pixels</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pixel_corners</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pixel_corners</span><span class="o">.</span><span class="n">y</span><span class="p">)])</span><span class="o">.</span><span class="n">value</span>
            <span class="n">y_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">y_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">y_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bottom_left</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bottom_left</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">)</span> <span class="ow">and</span>
              <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_right</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bottom_left</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">pix</span><span class="p">)):</span>

            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GenericMap.submap now takes pixel values as `bottom_left`&quot;</span>
                          <span class="s2">&quot; and `top_right` not `range_a` and `range_b`&quot;</span><span class="p">,</span> <span class="ne">Warning</span><span class="p">)</span>

            <span class="n">x_pixels</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">bottom_left</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">value</span>
            <span class="n">y_pixels</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">top_right</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bottom_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">value</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid input, bottom_left and top_right must either be SkyCoord or Quantity in pixels.&quot;</span><span class="p">)</span>

        <span class="c1"># Sort the pixel values so we always slice in the correct direction</span>
        <span class="n">x_pixels</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">y_pixels</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">x_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_pixels</span><span class="p">)</span>
        <span class="n">y_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pixels</span><span class="p">)</span>

        <span class="c1"># Clip pixel values to max of array, prevents negative</span>
        <span class="c1"># indexing</span>
        <span class="n">x_pixels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">x_pixels</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x_pixels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">x_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">y_pixels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">y_pixels</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y_pixels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">y_pixels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Get ndarray representation of submap</span>
        <span class="n">xslice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">yslice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_pixels</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">yslice</span><span class="p">,</span> <span class="n">xslice</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Make a copy of the header with updated centering information</span>
        <span class="n">new_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_pixel</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">x_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_pixel</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">y_pixels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;naxis1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;naxis2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Create new map instance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">yslice</span><span class="p">,</span> <span class="n">xslice</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># Create new map with the modification</span>
            <span class="n">new_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_instance</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">new_mask</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_map</span>
        <span class="c1"># Create new map with the modification</span>
        <span class="n">new_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_instance</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_map</span></div>

    <span class="nd">@u</span><span class="o">.</span><span class="n">quantity_input</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.superpixel"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.superpixel">[docs]</a>    <span class="k">def</span> <span class="nf">superpixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pixel</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a new map consisting of superpixels formed by applying</span>
<span class="sd">        &#39;func&#39; to the original map data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dimensions : tuple</span>
<span class="sd">            One superpixel in the new map is equal to (dimension[0],</span>
<span class="sd">            dimension[1]) pixels of the original map.</span>
<span class="sd">            Note: the first argument corresponds to the &#39;x&#39; axis and the second</span>
<span class="sd">            argument corresponds to the &#39;y&#39; axis.</span>
<span class="sd">        offset : tuple</span>
<span class="sd">            Offset from (0,0) in original map pixels used to calculate where</span>
<span class="sd">            the data used to make the resulting superpixel map starts.</span>
<span class="sd">        func : function applied to the original data</span>
<span class="sd">            The function &#39;func&#39; must take a numpy array as its first argument,</span>
<span class="sd">            and support the axis keyword with the meaning of a numpy axis</span>
<span class="sd">            keyword (see the description of `~numpy.sum` for an example.)</span>
<span class="sd">            The default value of &#39;func&#39; is `~numpy.sum`; using this causes</span>
<span class="sd">            superpixel to sum over (dimension[0], dimension[1]) pixels of the</span>
<span class="sd">            original map.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : `~sunpy.map.GenericMap` or subclass</span>
<span class="sd">            A new Map which has superpixels of the required size.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        | `Summarizing blocks of an array using a moving window &lt;http://mail.scipy.org/pipermail/numpy-discussion/2010-July/051760.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Note: because the underlying ndarray is transposed in sense when</span>
        <span class="c1">#   compared to the Map, the ndarray is transposed, resampled, then</span>
        <span class="c1">#   transposed back.</span>
        <span class="c1"># Note: &quot;center&quot; defaults to True in this function because data</span>
        <span class="c1">#   coordinates in a Map are at pixel centers.</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">offset</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">offset</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Offset is strictly non-negative.&quot;</span><span class="p">)</span>

        <span class="c1"># Make a copy of the original data, perform reshaping, and apply the</span>
        <span class="c1"># function.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reshaped</span> <span class="o">=</span> <span class="n">reshape_image_to_4d_superpixel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">),</span>
                                                      <span class="p">[</span><span class="n">dimensions</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dimensions</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                                      <span class="p">[</span><span class="n">offset</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">offset</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reshaped</span> <span class="o">=</span> <span class="n">reshape_image_to_4d_superpixel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                                      <span class="p">[</span><span class="n">dimensions</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dimensions</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                                      <span class="p">[</span><span class="n">offset</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">offset</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">new_array</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">reshaped</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Update image scale and number of pixels</span>

        <span class="c1"># create copy of new meta data</span>
        <span class="n">new_meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">new_nx</span> <span class="o">=</span> <span class="n">new_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_ny</span> <span class="o">=</span> <span class="n">new_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Update metadata</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;cdelt1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">value</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;cdelt2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="s1">&#39;CD1_1&#39;</span> <span class="ow">in</span> <span class="n">new_meta</span><span class="p">:</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;CD1_1&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;CD2_1&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;CD1_2&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;CD2_2&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crpix2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crval1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">value</span>
        <span class="n">new_meta</span><span class="p">[</span><span class="s1">&#39;crval2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Create new map instance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">new_array</span><span class="p">)</span>
            <span class="n">new_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">new_array</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">new_array</span>
            <span class="n">new_mask</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Create new map with the modified data</span>
        <span class="n">new_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_instance</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">new_mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_map</span></div>

<span class="c1"># #### Visualization #### #</span>

    <span class="nd">@u</span><span class="o">.</span><span class="n">quantity_input</span><span class="p">(</span><span class="n">grid_spacing</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.draw_grid"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.draw_grid">[docs]</a>    <span class="k">def</span> <span class="nf">draw_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_spacing</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws a coordinate overlay on the plot in the Heliographic Stonyhurst</span>
<span class="sd">        coordinate system.</span>

<span class="sd">        To overlay other coordinate systems see the `WCSAxes Documentation</span>
<span class="sd">        &lt;http://docs.astropy.org/en/stable/visualization/wcsaxes/overlaying_coordinate_systems.html&gt;`_</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        axes: `~matplotlib.axes` or None</span>
<span class="sd">        Axes to plot limb on or None to use current axes.</span>

<span class="sd">        grid_spacing: `~astropy.units.Quantity`</span>
<span class="sd">            Spacing for longitude and latitude grid, if length two it specifies</span>
<span class="sd">            (lon, lat) spacing.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        overlay: `~astropy.visualization.wcsaxes.coordinates_map.CoordinatesMap`</span>
<span class="sd">            The wcsaxes coordinate overlay instance.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Keyword arguments are passed onto the `sunpy.visualization.wcsaxes_compat.wcsaxes_heliographic_overlay` function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">gca_wcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">is_wcsaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Overlay grids can only be plotted on WCSAxes plots.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">wcsaxes_heliographic_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span>
                                                           <span class="n">grid_spacing</span><span class="o">=</span><span class="n">grid_spacing</span><span class="p">,</span>
                                                           <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericMap.draw_limb"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.draw_limb">[docs]</a>    <span class="k">def</span> <span class="nf">draw_limb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws a circle representing the solar limb</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        axes: `~matplotlib.axes` or None</span>
<span class="sd">            Axes to plot limb on or None to use current axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        circ: list</span>
<span class="sd">            A list containing the `~matplotlib.patches.Circle` object that</span>
<span class="sd">            has been added to the axes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Keyword arguments are passed onto `matplotlib.patches.Circle`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">gca_wcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

        <span class="n">transform</span> <span class="o">=</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">get_world_transform</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">is_wcsaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsun_obs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsun_obs</span><span class="o">.</span><span class="n">value</span>
        <span class="n">c_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="n">radius</span><span class="p">,</span>
                <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">transform</span>
                <span class="p">}</span>
        <span class="n">c_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">circ</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Circle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">c_kw</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">circ</span><span class="p">]</span></div>

    <span class="nd">@u</span><span class="o">.</span><span class="n">quantity_input</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.draw_rectangle"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.draw_rectangle">[docs]</a>    <span class="k">def</span> <span class="nf">draw_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bottom_left</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a rectangle defined in world coordinates on the plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        bottom_left : `~astropy.coordinates.SkyCoord` or `~astropy.coordinates.BaseCoordinateFrame`</span>
<span class="sd">            The bottom left corner of the rectangle.</span>

<span class="sd">        width : `astropy.units.Quantity`</span>
<span class="sd">            The width of the rectangle.</span>

<span class="sd">        height : `astropy.units.Quantity`</span>
<span class="sd">            The height of the rectangle.</span>

<span class="sd">        axes : `matplotlib.axes.Axes`</span>
<span class="sd">            The axes on which to plot the rectangle, defaults to the current</span>
<span class="sd">            axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        rect : `list`</span>
<span class="sd">            A list containing the `~matplotlib.patches.Rectangle` object, after</span>
<span class="sd">            it has been added to ``axes``.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Extra keyword arguments to this function are passed through to the</span>
<span class="sd">        `~matplotlib.patches.Rectangle` instance.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">is_wcsaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">axes_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">coord</span> <span class="o">=</span> <span class="n">bottom_left</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_frame</span><span class="p">)</span>
        <span class="n">bottom_left</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">((</span><span class="n">coord</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">coord</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span>
                                 <span class="n">unit</span><span class="o">=</span><span class="n">axes_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

        <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">axes_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">axes_unit</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

        <span class="n">kwergs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">get_world_transform</span><span class="p">(</span><span class="n">axes</span><span class="p">),</span>
                  <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">kwergs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">bottom_left</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="o">**</span><span class="n">kwergs</span><span class="p">)</span>

        <span class="n">axes</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">rect</span><span class="p">]</span></div>

    <span class="nd">@u</span><span class="o">.</span><span class="n">quantity_input</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">percent</span><span class="p">)</span>
<div class="viewcode-block" id="GenericMap.draw_contours"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.draw_contours">[docs]</a>    <span class="k">def</span> <span class="nf">draw_contours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">contour_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw contours of the data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        levels : `~astropy.units.Quantity`</span>
<span class="sd">            A list of numbers indicating the level curves to draw given in</span>
<span class="sd">            percent.</span>

<span class="sd">        axes : `matplotlib.axes.Axes`</span>
<span class="sd">            The axes on which to plot the rectangle, defaults to the current</span>
<span class="sd">            axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        cs : `list`</span>
<span class="sd">            The `~matplotlib.QuadContourSet` object, after it has been added to</span>
<span class="sd">            ``axes``.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Extra keyword arguments to this function are passed through to the</span>
<span class="sd">        `~matplotlib.pyplot.contour` function.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">gca_wcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

        <span class="c1"># TODO: allow for use of direct input of contours but requires units of</span>
        <span class="c1"># map flux which is not yet implemented</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">levels</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                          <span class="o">**</span><span class="n">contour_args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cs</span></div>

    <span class="nd">@toggle_pylab</span>
<div class="viewcode-block" id="GenericMap.peek"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.peek">[docs]</a>    <span class="k">def</span> <span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draw_limb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">draw_grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">basic_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">matplot_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays the map in a new figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        draw_limb : bool</span>
<span class="sd">            Whether the solar limb should be plotted.</span>

<span class="sd">        draw_grid : bool or `~astropy.units.Quantity`</span>
<span class="sd">            Whether solar meridians and parallels are plotted.</span>
<span class="sd">            If `~astropy.units.Quantity` then sets degree difference between</span>
<span class="sd">            parallels and meridians.</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Gamma value to use for the color map</span>
<span class="sd">        colorbar : bool</span>
<span class="sd">            Whether to display a colorbar next to the plot</span>
<span class="sd">        basic_plot : bool</span>
<span class="sd">            If true, the data is plotted by itself at it&#39;s natural scale; no</span>
<span class="sd">            title, labels, or axes are shown.</span>
<span class="sd">        **matplot_args : dict</span>
<span class="sd">            Matplotlib Any additional imshow arguments that should be used</span>
<span class="sd">            when plotting.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create a figure and add title and axes</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="ow">not</span> <span class="n">basic_plot</span><span class="p">)</span>

        <span class="c1"># Basic plot</span>
        <span class="k">if</span> <span class="n">basic_plot</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
            <span class="n">figure</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
            <span class="n">matplot_args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;annotate&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;_basic_plot&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

        <span class="c1"># Normal plot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">gca_wcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

        <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">matplot_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">colorbar</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">basic_plot</span><span class="p">:</span>
            <span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">draw_limb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_limb</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">draw_grid</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">draw_grid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">draw_grid</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_grid</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">grid_spacing</span><span class="o">=</span><span class="n">draw_grid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;draw_grid should be a bool or an astropy Quantity.&quot;</span><span class="p">)</span>

        <span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    <span class="nd">@toggle_pylab</span>
<div class="viewcode-block" id="GenericMap.plot"><a class="viewcode-back" href="../../../code_ref/map.html#sunpy.map.GenericMap.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">imshow_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the map object using matplotlib, in a method equivalent</span>
<span class="sd">        to plt.imshow() using nearest neighbour interpolation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        annotate : bool</span>
<span class="sd">            If True, the data is plotted at it&#39;s natural scale; with</span>
<span class="sd">            title and axis labels.</span>

<span class="sd">        axes: `~matplotlib.axes` or None</span>
<span class="sd">            If provided the image will be plotted on the given axes. Else the</span>
<span class="sd">            current matplotlib axes will be used.</span>

<span class="sd">        **imshow_kwargs  : dict</span>
<span class="sd">            Any additional imshow arguments that should be used</span>
<span class="sd">            when plotting.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # Simple Plot with color bar</span>
<span class="sd">        &gt;&gt;&gt; aia.plot()   # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; plt.colorbar()   # doctest: +SKIP</span>

<span class="sd">        &gt;&gt;&gt; # Add a limb line and grid</span>
<span class="sd">        &gt;&gt;&gt; aia.plot()   # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; aia.draw_limb()   # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; aia.draw_grid()   # doctest: +SKIP</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># extract hiddden kwarg</span>
        <span class="n">_basic_plot</span> <span class="o">=</span> <span class="n">imshow_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_basic_plot&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get current axes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">gca_wcs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_basic_plot</span><span class="p">:</span>
            <span class="c1"># Check that the image is properly oriented</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">is_wcsaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)))):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;This map is not properly oriented. Plot axes may be incorrect&quot;</span><span class="p">,</span>
                              <span class="ne">Warning</span><span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">is_wcsaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;WCSAxes not being used as the axes object for this plot.&quot;</span>
                              <span class="s2">&quot; Plots may have expected behaviour&quot;</span><span class="p">,</span>
                              <span class="ne">Warning</span><span class="p">)</span>

        <span class="c1"># Normal plot</span>
        <span class="n">imshow_args</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_settings</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">imshow_args</span><span class="p">:</span>
            <span class="n">plot_settings_title</span> <span class="o">=</span> <span class="n">imshow_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_settings_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latex_name</span>

        <span class="k">if</span> <span class="n">annotate</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">plot_settings_title</span>

            <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">axis_labels_from_ctype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">axis_labels_from_ctype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">is_wcsaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">bl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bottom_left_coord</span><span class="p">)</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lon_lat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_right_coord</span><span class="p">)</span>
            <span class="n">x_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">y_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">imshow_args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;extent&#39;</span><span class="p">:</span> <span class="n">x_range</span> <span class="o">+</span> <span class="n">y_range</span><span class="p">})</span>
        <span class="n">imshow_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">imshow_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">imshow_args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">),</span> <span class="o">**</span><span class="n">imshow_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">is_wcsaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">wcsaxes_compat</span><span class="o">.</span><span class="n">default_wcs_grid</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spatial_units</span><span class="p">,</span>
                                            <span class="n">ctypes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">)</span>

        <span class="c1"># Set current image (makes colorbar work)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span></div></div>


<span class="k">class</span> <span class="nc">InvalidHeaderInformation</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception to raise when an invalid header tag value is encountered for a</span>
<span class="sd">    FITS/JPEG 2000 file.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, The SunPy Community.<br/>
      Last updated on 14 Aug 2017.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>